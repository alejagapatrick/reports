<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - test_bitcoin_coverage.info - src/wallet/init.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">src/wallet</a> - init.cpp<span style="font-size: 80%;"> (source / <a href="init.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">test_bitcoin_coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">23</td>
            <td class="headerCovTableEntry">135</td>
            <td class="headerCovTableEntryLo">17.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2000-01-01 12:00:00</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">5</td>
            <td class="headerCovTableEntry">14</td>
            <td class="headerCovTableEntryLo">35.7 %</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">31</td>
            <td class="headerCovTableEntry">432</td>
            <td class="headerCovTableEntryLo">7.2 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : // Copyright (c) 2009-2010 Satoshi Nakamoto</a>
<span class="lineNum">       2 </span>                :            : // Copyright (c) 2009-2018 The Bitcoin Core developers
<span class="lineNum">       3 </span>                :            : // Distributed under the MIT software license, see the accompanying
<span class="lineNum">       4 </span>                :            : // file COPYING or http://www.opensource.org/licenses/mit-license.php.
<span class="lineNum">       5 </span>                :            : 
<span class="lineNum">       6 </span>                :            : #include &lt;chainparams.h&gt;
<span class="lineNum">       7 </span>                :            : #include &lt;init.h&gt;
<span class="lineNum">       8 </span>                :            : #include &lt;interfaces/chain.h&gt;
<span class="lineNum">       9 </span>                :            : #include &lt;net.h&gt;
<span class="lineNum">      10 </span>                :            : #include &lt;scheduler.h&gt;
<span class="lineNum">      11 </span>                :            : #include &lt;outputtype.h&gt;
<span class="lineNum">      12 </span>                :            : #include &lt;util/system.h&gt;
<span class="lineNum">      13 </span>                :            : #include &lt;util/moneystr.h&gt;
<span class="lineNum">      14 </span>                :            : #include &lt;validation.h&gt;
<span class="lineNum">      15 </span>                :            : #include &lt;walletinitinterface.h&gt;
<span class="lineNum">      16 </span>                :            : #include &lt;wallet/rpcwallet.h&gt;
<span class="lineNum">      17 </span>                :            : #include &lt;wallet/wallet.h&gt;
<a name="18"><span class="lineNum">      18 </span>                :            : #include &lt;wallet/walletutil.h&gt;</a>
<span class="lineNum">      19 </span>                :            : 
<span class="lineNum">      20 </span>                :<span class="lineCov">         72 : class WalletInit : public WalletInitInterface {</span>
<span class="lineNum">      21 </span>                :            : public:
<a name="22"><span class="lineNum">      22 </span>                :            : </a>
<span class="lineNum">      23 </span>                :            :     //! Was the wallet component compiled in.
<span class="lineNum">      24 </span>                :<span class="lineNoCov">          0 :     bool HasWalletSupport() const override {return true;}</span>
<span class="lineNum">      25 </span>                :            : 
<span class="lineNum">      26 </span>                :            :     //! Return the wallets help message.
<span class="lineNum">      27 </span>                :            :     void AddWalletOptions() const override;
<span class="lineNum">      28 </span>                :            : 
<span class="lineNum">      29 </span>                :            :     //! Wallets parameter interaction
<span class="lineNum">      30 </span>                :            :     bool ParameterInteraction() const override;
<span class="lineNum">      31 </span>                :            : 
<span class="lineNum">      32 </span>                :            :     //! Add wallets that should be opened to list of init interfaces.
<span class="lineNum">      33 </span>                :            :     void Construct(InitInterfaces&amp; interfaces) const override;
<span class="lineNum">      34 </span>                :            : };
<span class="lineNum">      35 </span>                :            : 
<a name="36"><span class="lineNum">      36 </span>                :<span class="lineCov">         72 : const WalletInitInterface&amp; g_wallet_init_interface = WalletInit();</span></a>
<span class="lineNum">      37 </span>                :            : 
<span class="lineNum">      38 </span>                :<span class="lineNoCov">          0 : void WalletInit::AddWalletOptions() const</span>
<span class="lineNum">      39 </span>                :            : {
<span class="lineNum">      40 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-addresstype&quot;, strprintf(&quot;What type of addresses to use (\&quot;legacy\&quot;, \&quot;p2sh-segwit\&quot;, or \&quot;bech32\&quot;, default: \&quot;%s\&quot;)&quot;, FormatOutputType(DEFAULT_ADDRESS_TYPE)), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      41 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-avoidpartialspends&quot;, strprintf(&quot;Group outputs by address, selecting all or none, instead of selecting on a per-output basis. Privacy is improved as an address is only used once (unless someone sends to it after spending from it), but may result in slightly higher fees as suboptimal coin selection may result due to the added limitation (default: %u)&quot;, DEFAULT_AVOIDPARTIALSPENDS), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      42 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-changetype&quot;, &quot;What type of change to use (\&quot;legacy\&quot;, \&quot;p2sh-segwit\&quot;, or \&quot;bech32\&quot;). Default is same as -addresstype, except when -addresstype=p2sh-segwit a native segwit output is used when sending to a native segwit address)&quot;, false, OptionsCategory::WALLET);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      43 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-disablewallet&quot;, &quot;Do not load the wallet and disable wallet RPC calls&quot;, false, OptionsCategory::WALLET);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      44 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-discardfee=&lt;amt&gt;&quot;, strprintf(&quot;The fee rate (in %s/kB) that indicates your tolerance for discarding change by adding it to the fee (default: %s). &quot;</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      45 </span>                :            :                                                                 &quot;Note: An output is discarded if it is dust at this rate, but we will always discard up to the dust relay fee and a discard fee above that is limited by the fee estimate for the longest target&quot;,
<span class="lineNum">      46 </span>                :<span class="lineNoCov">          0 :                                                               CURRENCY_UNIT, FormatMoney(DEFAULT_DISCARD_FEE)), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      47 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-fallbackfee=&lt;amt&gt;&quot;, strprintf(&quot;A fee rate (in %s/kB) that will be used when fee estimation has insufficient data (default: %s)&quot;,</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      48 </span>                :<span class="lineNoCov">          0 :                                                                CURRENCY_UNIT, FormatMoney(DEFAULT_FALLBACK_FEE)), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      49 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-keypool=&lt;n&gt;&quot;, strprintf(&quot;Set key pool size to &lt;n&gt; (default: %u)&quot;, DEFAULT_KEYPOOL_SIZE), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      50 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-mintxfee=&lt;amt&gt;&quot;, strprintf(&quot;Fees (in %s/kB) smaller than this are considered zero fee for transaction creation (default: %s)&quot;,</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      51 </span>                :<span class="lineNoCov">          0 :                                                             CURRENCY_UNIT, FormatMoney(DEFAULT_TRANSACTION_MINFEE)), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      52 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-paytxfee=&lt;amt&gt;&quot;, strprintf(&quot;Fee (in %s/kB) to add to transactions you send (default: %s)&quot;,</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      53 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                                             CURRENCY_UNIT, FormatMoney(CFeeRate{DEFAULT_PAY_TX_FEE}.GetFeePerK())), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      54 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-rescan&quot;, &quot;Rescan the block chain for missing wallet transactions on startup&quot;, false, OptionsCategory::WALLET);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      55 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-salvagewallet&quot;, &quot;Attempt to recover private keys from a corrupt wallet on startup&quot;, false, OptionsCategory::WALLET);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      56 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-spendzeroconfchange&quot;, strprintf(&quot;Spend unconfirmed change when sending transactions (default: %u)&quot;, DEFAULT_SPEND_ZEROCONF_CHANGE), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      57 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-txconfirmtarget=&lt;n&gt;&quot;, strprintf(&quot;If paytxfee is not set, include enough fee so transactions begin confirmation on average within n blocks (default: %u)&quot;, DEFAULT_TX_CONFIRM_TARGET), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      58 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-upgradewallet&quot;, &quot;Upgrade wallet to latest format on startup&quot;, false, OptionsCategory::WALLET);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      59 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-wallet=&lt;path&gt;&quot;, &quot;Specify wallet database path. Can be specified multiple times to load multiple wallets. Path is interpreted relative to &lt;walletdir&gt; if it is not absolute, and will be created if it does not exist (as a directory containing a wallet.dat file and log files). For backwards compatibility this will also accept names of existing data files in &lt;walletdir&gt;.)&quot;, false, OptionsCategory::WALLET);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      60 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-walletbroadcast&quot;,  strprintf(&quot;Make the wallet broadcast transactions (default: %u)&quot;, DEFAULT_WALLETBROADCAST), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      61 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-walletdir=&lt;dir&gt;&quot;, &quot;Specify directory to hold wallets (default: &lt;datadir&gt;/wallets if it exists, otherwise &lt;datadir&gt;)&quot;, false, OptionsCategory::WALLET);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      62 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-walletnotify=&lt;cmd&gt;&quot;, &quot;Execute command when a wallet transaction changes (%s in cmd is replaced by TxID)&quot;, false, OptionsCategory::WALLET);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      63 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-walletrbf&quot;, strprintf(&quot;Send transactions with full-RBF opt-in enabled (RPC only, default: %u)&quot;, DEFAULT_WALLET_RBF), false, OptionsCategory::WALLET);</span>
<span class="lineNum">      64 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-zapwallettxes=&lt;mode&gt;&quot;, &quot;Delete all wallet transactions and only recover those parts of the blockchain through -rescan on startup&quot;</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">      65 </span>                :            :                                &quot; (1 = keep tx meta data e.g. payment request information, 2 = drop tx meta data)&quot;, false, OptionsCategory::WALLET);
<span class="lineNum">      66 </span>                :            : 
<span class="lineNum">      67 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-dblogsize=&lt;n&gt;&quot;, strprintf(&quot;Flush wallet database activity from memory to disk log every &lt;n&gt; megabytes (default: %u)&quot;, DEFAULT_WALLET_DBLOGSIZE), true, OptionsCategory::WALLET_DEBUG_TEST);</span>
<span class="lineNum">      68 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-flushwallet&quot;, strprintf(&quot;Run a thread to flush wallet periodically (default: %u)&quot;, DEFAULT_FLUSHWALLET), true, OptionsCategory::WALLET_DEBUG_TEST);</span>
<span class="lineNum">      69 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-privdb&quot;, strprintf(&quot;Sets the DB_PRIVATE flag in the wallet db environment (default: %u)&quot;, DEFAULT_WALLET_PRIVDB), true, OptionsCategory::WALLET_DEBUG_TEST);</span>
<span class="lineNum">      70 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.AddArg(&quot;-walletrejectlongchains&quot;, strprintf(&quot;Wallet will not create transactions that violate mempool chain limits (default: %u)&quot;, DEFAULT_WALLET_REJECT_LONG_CHAINS), true, OptionsCategory::WALLET_DEBUG_TEST);</span>
<a name="71"><span class="lineNum">      71 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      72 </span>                :            : 
<span class="lineNum">      73 </span>                :<span class="lineNoCov">          0 : bool WalletInit::ParameterInteraction() const</span>
<span class="lineNum">      74 </span>                :            : {
<span class="lineNum">      75 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (gArgs.GetBoolArg(&quot;-disablewallet&quot;, DEFAULT_DISABLE_WALLET)) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">      76 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         for (const std::string&amp; wallet : gArgs.GetArgs(&quot;-wallet&quot;)) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">      77 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :             LogPrintf(&quot;%s: parameter interaction: -disablewallet -&gt; ignoring -wallet=%s\n&quot;, __func__, wallet);</span>
<span class="lineNum">      78 </span>                :            :         }
<span class="lineNum">      79 </span>                :            : 
<span class="lineNum">      80 </span>                :<span class="lineNoCov">          0 :         return true;</span>
<span class="lineNum">      81 </span>                :            :     }
<span class="lineNum">      82 </span>                :            : 
<span class="lineNum">      83 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     const bool is_multiwallet = gArgs.GetArgs(&quot;-wallet&quot;).size() &gt; 1;</span>
<span class="lineNum">      84 </span>                :            : 
<span class="lineNum">      85 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (gArgs.GetBoolArg(&quot;-blocksonly&quot;, DEFAULT_BLOCKSONLY) &amp;&amp; gArgs.SoftSetBoolArg(&quot;-walletbroadcast&quot;, false)) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 12 was not executed"> # </span><span class="branchNoExec" title="Branch 13 was not executed"> # </span>][<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>][<span class="branchNoExec" title="Branch 18 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span> 
<span class="lineNum">         </span>   <span class="branchNoExec" title="Branch 20 was not executed"> # </span><span class="branchNoExec" title="Branch 21 was not executed"> # </span><span class="branchNoExec" title="Branch 22 was not executed"> # </span><span class="branchNoExec" title="Branch 23 was not executed"> # </span>]
<span class="lineNum">      86 </span>                :<span class="lineNoCov">          0 :         LogPrintf(&quot;%s: parameter interaction: -blocksonly=1 -&gt; setting -walletbroadcast=0\n&quot;, __func__);</span>
<span class="lineNum">      87 </span>                :            :     }
<span class="lineNum">      88 </span>                :            : 
<span class="lineNum">      89 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (gArgs.GetBoolArg(&quot;-salvagewallet&quot;, false)) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">      90 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (is_multiwallet) {</span>
<span class="lineNum">      91 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(strprintf(&quot;%s is only allowed with a single wallet file&quot;, &quot;-salvagewallet&quot;));</span>
<span class="lineNum">      92 </span>                :            :         }
<span class="lineNum">      93 </span>                :            :         // Rewrite just private keys: rescan to find transactions
<span class="lineNum">      94 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (gArgs.SoftSetBoolArg(&quot;-rescan&quot;, true)) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">      95 </span>                :<span class="lineNoCov">          0 :             LogPrintf(&quot;%s: parameter interaction: -salvagewallet=1 -&gt; setting -rescan=1\n&quot;, __func__);</span>
<span class="lineNum">      96 </span>                :            :         }
<span class="lineNum">      97 </span>                :            :     }
<span class="lineNum">      98 </span>                :            : 
<span class="lineNum">      99 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     bool zapwallettxes = gArgs.GetBoolArg(&quot;-zapwallettxes&quot;, false);</span>
<span class="lineNum">     100 </span>                :            :     // -zapwallettxes implies dropping the mempool on startup
<span class="lineNum">     101 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (zapwallettxes &amp;&amp; gArgs.SoftSetBoolArg(&quot;-persistmempool&quot;, false)) {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">     102 </span>                :<span class="lineNoCov">          0 :         LogPrintf(&quot;%s: parameter interaction: -zapwallettxes enabled -&gt; setting -persistmempool=0\n&quot;, __func__);</span>
<span class="lineNum">     103 </span>                :            :     }
<span class="lineNum">     104 </span>                :            : 
<span class="lineNum">     105 </span>                :            :     // -zapwallettxes implies a rescan
<span class="lineNum">     106 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (zapwallettxes) {</span>
<span class="lineNum">     107 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (is_multiwallet) {</span>
<span class="lineNum">     108 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(strprintf(&quot;%s is only allowed with a single wallet file&quot;, &quot;-zapwallettxes&quot;));</span>
<span class="lineNum">     109 </span>                :            :         }
<span class="lineNum">     110 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (gArgs.SoftSetBoolArg(&quot;-rescan&quot;, true)) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">     111 </span>                :<span class="lineNoCov">          0 :             LogPrintf(&quot;%s: parameter interaction: -zapwallettxes enabled -&gt; setting -rescan=1\n&quot;, __func__);</span>
<span class="lineNum">     112 </span>                :            :         }
<span class="lineNum">     113 </span>                :            :     }
<span class="lineNum">     114 </span>                :            : 
<span class="lineNum">     115 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (is_multiwallet) {</span>
<span class="lineNum">     116 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (gArgs.GetBoolArg(&quot;-upgradewallet&quot;, false)) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">     117 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(strprintf(&quot;%s is only allowed with a single wallet file&quot;, &quot;-upgradewallet&quot;));</span>
<span class="lineNum">     118 </span>                :            :         }
<span class="lineNum">     119 </span>                :            :     }
<span class="lineNum">     120 </span>                :            : 
<span class="lineNum">     121 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (gArgs.GetBoolArg(&quot;-sysperms&quot;, false))</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">     122 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         return InitError(&quot;-sysperms is not allowed in combination with enabled wallet functionality&quot;);</span>
<span class="lineNum">     123 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (gArgs.GetArg(&quot;-prune&quot;, 0) &amp;&amp; gArgs.GetBoolArg(&quot;-rescan&quot;, false))</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 12 was not executed"> # </span><span class="branchNoExec" title="Branch 13 was not executed"> # </span>][<span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 16 was not executed"> # </span><span class="branchNoExec" title="Branch 17 was not executed"> # </span>][<span class="branchNoExec" title="Branch 18 was not executed"> # </span><span class="branchNoExec" title="Branch 19 was not executed"> # </span> 
<span class="lineNum">         </span>   <span class="branchNoExec" title="Branch 20 was not executed"> # </span><span class="branchNoExec" title="Branch 21 was not executed"> # </span><span class="branchNoExec" title="Branch 22 was not executed"> # </span><span class="branchNoExec" title="Branch 23 was not executed"> # </span>]
<span class="lineNum">     124 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         return InitError(_(&quot;Rescans are not possible in pruned mode. You will need to use -reindex which will download the whole blockchain again.&quot;));</span>
<span class="lineNum">     125 </span>                :            : 
<span class="lineNum">     126 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (::minRelayTxFee.GetFeePerK() &gt; HIGH_TX_FEE_PER_KB)</span>
<span class="lineNum">     127 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         InitWarning(AmountHighWarn(&quot;-minrelaytxfee&quot;) + &quot; &quot; +</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>]
<span class="lineNum">     128 </span>                :<span class="lineNoCov">          0 :                     _(&quot;The wallet will avoid paying less than the minimum relay fee.&quot;));</span>
<span class="lineNum">     129 </span>                :            : 
<span class="lineNum">     130 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (gArgs.IsArgSet(&quot;-maxtxfee&quot;))</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">     131 </span>                :            :     {
<span class="lineNum">     132 </span>                :<span class="lineNoCov">          0 :         CAmount nMaxFee = 0;</span>
<span class="lineNum">     133 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (!ParseMoney(gArgs.GetArg(&quot;-maxtxfee&quot;, &quot;&quot;), nMaxFee))</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 12 was not executed"> # </span><span class="branchNoExec" title="Branch 13 was not executed"> # </span>]
<span class="lineNum">     134 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(AmountErrMsg(&quot;maxtxfee&quot;, gArgs.GetArg(&quot;-maxtxfee&quot;, &quot;&quot;)));</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 13 was not executed"> # </span><span class="branchNoExec" title="Branch 14 was not executed"> # </span>]
<span class="lineNum">     135 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (nMaxFee &gt; HIGH_MAX_TX_FEE)</span>
<span class="lineNum">     136 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             InitWarning(_(&quot;-maxtxfee is set very high! Fees this large could be paid on a single transaction.&quot;));</span>
<span class="lineNum">     137 </span>                :<span class="lineNoCov">          0 :         maxTxFee = nMaxFee;</span>
<span class="lineNum">     138 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (CFeeRate(maxTxFee, 1000) &lt; ::minRelayTxFee)</span>
<span class="lineNum">     139 </span>                :            :         {
<span class="lineNum">     140 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(strprintf(_(&quot;Invalid amount for -maxtxfee=&lt;amount&gt;: '%s' (must be at least the minrelay fee of %s to prevent stuck transactions)&quot;),</span>
<span class="lineNum">     141 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                        gArgs.GetArg(&quot;-maxtxfee&quot;, &quot;&quot;), ::minRelayTxFee.ToString()));</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>][<span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span>]
<span class="lineNum">     142 </span>                :            :         }
<span class="lineNum">     143 </span>                :            :     }
<span class="lineNum">     144 </span>                :            : 
<span class="lineNum">     145 </span>                :            :     return true;
<a name="146"><span class="lineNum">     146 </span>                :            : }</a>
<span class="lineNum">     147 </span>                :            : 
<span class="lineNum">     148 </span>                :<span class="lineCov">          7 : bool VerifyWallets(interfaces::Chain&amp; chain, const std::vector&lt;std::string&gt;&amp; wallet_files)</span>
<span class="lineNum">     149 </span>                :            : {
<span class="lineNum">     150 </span>[<span class="branchCov" title="Branch 1 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         14 :     if (gArgs.IsArgSet(&quot;-walletdir&quot;)) {</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 6 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<span class="lineNum">     151 </span>[<span class="branchCov" title="Branch 1 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">         11 :         fs::path wallet_dir = gArgs.GetArg(&quot;-walletdir&quot;, &quot;&quot;);</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     152 </span>                :<span class="lineCov">          7 :         boost::system::error_code error;</span>
<span class="lineNum">     153 </span>                :            :         // The canonical path cleans the path, preventing &gt;1 Berkeley environment instances for the same directory
<span class="lineNum">     154 </span>        [<span class="branchCov" title="Branch 1 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          7 :         fs::path canonical_wallet_dir = fs::canonical(wallet_dir, error);</span>
<span class="lineNum">     155 </span>                :<span class="lineNoCov">          0 :         if (error || !fs::exists(wallet_dir)) {</span>
<span class="lineNum">     156 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :             return InitError(strprintf(_(&quot;Specified -walletdir \&quot;%s\&quot; does not exist&quot;), wallet_dir.string()));</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     157 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 5 times"> + </span>]:<span class="lineCov">          6 :         } else if (!fs::is_directory(wallet_dir)) {</span>
<span class="lineNum">     158 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :             return InitError(strprintf(_(&quot;Specified -walletdir \&quot;%s\&quot; is not a directory&quot;), wallet_dir.string()));</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     159 </span>                :            :         // The canonical path transforms relative paths into absolute ones, so we check the non-canonical version
<span class="lineNum">     160 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">          5 :         } else if (!wallet_dir.is_absolute()) {</span>
<span class="lineNum">     161 </span>[<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          2 :             return InitError(strprintf(_(&quot;Specified -walletdir \&quot;%s\&quot; is a relative path&quot;), wallet_dir.string()));</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 7 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     162 </span>                :            :         }
<span class="lineNum">     163 </span>[<span class="branchCov" title="Branch 1 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          4 :         gArgs.ForceSetArg(&quot;-walletdir&quot;, canonical_wallet_dir.string());</span>
<span class="lineNum">     164 </span>                :            :     }
<span class="lineNum">     165 </span>                :            : 
<span class="lineNum">     166 </span>        [<span class="branchCov" title="Branch 2 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          4 :     LogPrintf(&quot;Using wallet directory %s\n&quot;, GetWalletDir().string());</span>
<span class="lineNum">     167 </span>                :            : 
<span class="lineNum">     168 </span>        [<span class="branchCov" title="Branch 2 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          4 :     uiInterface.InitMessage(_(&quot;Verifying wallet(s)...&quot;));</span>
<span class="lineNum">     169 </span>                :            : 
<span class="lineNum">     170 </span>                :            :     // Parameter interaction code should have thrown an error if -salvagewallet
<span class="lineNum">     171 </span>                :            :     // was enabled with more than wallet file, so the wallet_files size check
<span class="lineNum">     172 </span>                :            :     // here should have no effect.
<span class="lineNum">     173 </span>[<span class="branchCov" title="Branch 1 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 4 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]:<span class="lineCov">          4 :     bool salvage_wallet = gArgs.GetBoolArg(&quot;-salvagewallet&quot;, false) &amp;&amp; wallet_files.size() &lt;= 1;</span>
<span class="lineNum">         </span>[<span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchCov" title="Branch 7 was taken 4 times"> + </span>][<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">     174 </span>                :            : 
<span class="lineNum">     175 </span>                :            :     // Keep track of each wallet absolute path to detect duplicates.
<span class="lineNum">     176 </span>                :<span class="lineCov">          4 :     std::set&lt;fs::path&gt; wallet_paths;</span>
<span class="lineNum">     177 </span>                :            : 
<span class="lineNum">     178 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">          4 :     for (const auto&amp; wallet_file : wallet_files) {</span>
<span class="lineNum">     179 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         WalletLocation location(wallet_file);</span>
<span class="lineNum">     180 </span>                :            : 
<span class="lineNum">     181 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (!wallet_paths.insert(location.GetPath()).second) {</span>
<span class="lineNum">     182 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(strprintf(_(&quot;Error loading wallet %s. Duplicate -wallet filename specified.&quot;), wallet_file));</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     183 </span>                :            :         }
<span class="lineNum">     184 </span>                :            : 
<span class="lineNum">     185 </span>                :<span class="lineNoCov">          0 :         std::string error_string;</span>
<span class="lineNum">     186 </span>                :<span class="lineNoCov">          0 :         std::string warning_string;</span>
<span class="lineNum">     187 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         bool verify_success = CWallet::Verify(chain, location, salvage_wallet, error_string, warning_string);</span>
<span class="lineNum">     188 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (!error_string.empty()) InitError(error_string);</span>
<span class="lineNum">     189 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (!warning_string.empty()) InitWarning(warning_string);</span>
<span class="lineNum">     190 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (!verify_success) return false;</span>
<span class="lineNum">     191 </span>                :            :     }
<span class="lineNum">     192 </span>                :            : 
<span class="lineNum">     193 </span>                :<span class="lineCov">          4 :     return true;</span>
<a name="194"><span class="lineNum">     194 </span>                :            : }</a>
<span class="lineNum">     195 </span>                :            : 
<span class="lineNum">     196 </span>                :<span class="lineNoCov">          0 : void WalletInit::Construct(InitInterfaces&amp; interfaces) const</span>
<span class="lineNum">     197 </span>                :            : {
<span class="lineNum">     198 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (gArgs.GetBoolArg(&quot;-disablewallet&quot;, DEFAULT_DISABLE_WALLET)) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">     199 </span>                :<span class="lineNoCov">          0 :         LogPrintf(&quot;Wallet disabled!\n&quot;);</span>
<span class="lineNum">     200 </span>                :<span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">     201 </span>                :            :     }
<span class="lineNum">     202 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     gArgs.SoftSetArg(&quot;-wallet&quot;, &quot;&quot;);</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     203 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :     interfaces.chain_clients.emplace_back(interfaces::MakeWalletClient(*interfaces.chain, gArgs.GetArgs(&quot;-wallet&quot;)));</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>][<span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<a name="204"><span class="lineNum">     204 </span>                :            : }</a>
<span class="lineNum">     205 </span>                :            : 
<span class="lineNum">     206 </span>                :<span class="lineNoCov">          0 : bool LoadWallets(interfaces::Chain&amp; chain, const std::vector&lt;std::string&gt;&amp; wallet_files)</span>
<span class="lineNum">     207 </span>                :            : {
<span class="lineNum">     208 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :     for (const std::string&amp; walletFile : wallet_files) {</span>
<span class="lineNum">     209 </span>[<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :         std::shared_ptr&lt;CWallet&gt; pwallet = CWallet::CreateWalletFromFile(chain, WalletLocation(walletFile));</span>
<span class="lineNum">     210 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (!pwallet) {</span>
<span class="lineNum">     211 </span>                :<span class="lineNoCov">          0 :             return false;</span>
<span class="lineNum">     212 </span>                :            :         }
<span class="lineNum">     213 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         AddWallet(pwallet);</span>
<span class="lineNum">     214 </span>                :            :     }
<span class="lineNum">     215 </span>                :            : 
<span class="lineNum">     216 </span>                :<span class="lineNoCov">          0 :     return true;</span>
<a name="217"><span class="lineNum">     217 </span>                :            : }</a>
<span class="lineNum">     218 </span>                :            : 
<span class="lineNum">     219 </span>                :<span class="lineNoCov">          0 : void StartWallets(CScheduler&amp; scheduler)</span>
<span class="lineNum">     220 </span>                :            : {
<span class="lineNum">     221 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     for (const std::shared_ptr&lt;CWallet&gt;&amp; pwallet : GetWallets()) {</span>
<span class="lineNum">     222 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         pwallet-&gt;postInitProcess();</span>
<span class="lineNum">     223 </span>                :            :     }
<span class="lineNum">     224 </span>                :            : 
<span class="lineNum">     225 </span>                :            :     // Run a thread to flush wallet periodically
<span class="lineNum">     226 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :     scheduler.scheduleEvery(MaybeCompactWalletDB, 500);</span>
<a name="227"><span class="lineNum">     227 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     228 </span>                :            : 
<span class="lineNum">     229 </span>                :<span class="lineNoCov">          0 : void FlushWallets()</span>
<span class="lineNum">     230 </span>                :            : {
<span class="lineNum">     231 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     for (const std::shared_ptr&lt;CWallet&gt;&amp; pwallet : GetWallets()) {</span>
<span class="lineNum">     232 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         pwallet-&gt;Flush(false);</span>
<span class="lineNum">     233 </span>                :            :     }
<a name="234"><span class="lineNum">     234 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     235 </span>                :            : 
<span class="lineNum">     236 </span>                :<span class="lineNoCov">          0 : void StopWallets()</span>
<span class="lineNum">     237 </span>                :            : {
<span class="lineNum">     238 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :     for (const std::shared_ptr&lt;CWallet&gt;&amp; pwallet : GetWallets()) {</span>
<span class="lineNum">     239 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         pwallet-&gt;Flush(true);</span>
<span class="lineNum">     240 </span>                :            :     }
<a name="241"><span class="lineNum">     241 </span>                :<span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     242 </span>                :            : 
<span class="lineNum">     243 </span>                :<span class="lineCov">          7 : void UnloadWallets()</span>
<span class="lineNum">     244 </span>                :            : {
<span class="lineNum">     245 </span>                :<span class="lineCov">         14 :     auto wallets = GetWallets();</span>
<span class="lineNum">     246 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 7 times"> + </span>]:<span class="lineCov">          7 :     while (!wallets.empty()) {</span>
<span class="lineNum">     247 </span>                :<span class="lineNoCov">          0 :         auto wallet = wallets.back();</span>
<span class="lineNum">     248 </span>                :<span class="lineNoCov">          0 :         wallets.pop_back();</span>
<span class="lineNum">     249 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         RemoveWallet(wallet);</span>
<a name="250"><span class="lineNum">     250 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :         UnloadWallet(std::move(wallet));</span></a>
<span class="lineNum">     251 </span>                :            :     }
<span class="lineNum">     252 </span>[<span class="branchCov" title="Branch 1 was taken 72 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 72 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">        295 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
